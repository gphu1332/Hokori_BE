# ============================================
# Production Configuration for Railway
# ============================================
# This file is for Railway deployment
# Railway will automatically set DATABASE_URL environment variable
# Spring Boot 3.x automatically parses DATABASE_URL format: postgresql://user:pass@host:port/db

# Database Configuration (Railway PostgreSQL)
# Railway automatically provides DATABASE_URL in format: postgresql://user:password@host:port/database
# DataSourceConfig.java will parse DATABASE_URL and configure DataSource automatically
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA/Hibernate Configuration
# Use 'update' to auto-sync schema
# Note: Index creation errors (if index already exists) are non-critical and can be ignored
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true

# Disable JPA open-in-view (better performance)
spring.jpa.open-in-view=false

# Firebase Configuration (from environment variables)
# Option 1: Use environment variables (recommended for Railway)
firebase.enabled=${FIREBASE_ENABLED:true}
firebase.project-id=${FIREBASE_PROJECT_ID}
firebase.private-key-id=${FIREBASE_PRIVATE_KEY_ID}
firebase.private-key=${FIREBASE_PRIVATE_KEY}
firebase.client-email=${FIREBASE_CLIENT_EMAIL}
firebase.client-id=${FIREBASE_CLIENT_ID}
firebase.client-x509-cert-url=${FIREBASE_CLIENT_X509_CERT_URL}
# Option 2: Use JSON file (if uploaded to Railway)
firebase.credentials.path=${FIREBASE_CREDENTIALS_PATH:classpath:firebase-service-account.json}

# JWT Configuration (from environment variables)
# IMPORTANT: Generate a strong secret key for production!
# Use generate-jwt-secret.bat (Windows) or generate-jwt-secret.sh (Linux/Mac)
jwt.secret=${JWT_SECRET}
jwt.expiration=${JWT_EXPIRATION:86400000}

# Google Cloud AI Configuration (OPTIONAL - disable if no credentials)
# Set google.cloud.enabled=false to disable all AI features
google.cloud.enabled=${GOOGLE_CLOUD_ENABLED:false}
google.cloud.project-id=${GOOGLE_CLOUD_PROJECT_ID:hokori-web}
google.cloud.private-key-id=${GOOGLE_CLOUD_PRIVATE_KEY_ID:}
google.cloud.private-key=${GOOGLE_CLOUD_PRIVATE_KEY:}
google.cloud.client-email=${GOOGLE_CLOUD_CLIENT_EMAIL:}
google.cloud.client-id=${GOOGLE_CLOUD_CLIENT_ID:}
google.cloud.client-x509-cert-url=${GOOGLE_CLOUD_CLIENT_X509_CERT_URL:}

# Gemini AI Configuration
# Note: gemini-2.0-flash-exp has low quota (10 req/min). Use gemini-1.5-flash for higher quota.
ai.moderation.enable-gemini=${AI_MODERATION_ENABLE_GEMINI:true}
gemini.model=${GEMINI_MODEL:gemini-1.5-flash}
gemini.api.key=${GEMINI_API_KEY:}

# Google Cloud credentials can be loaded via:
# Option 1: Set GOOGLE_APPLICATION_CREDENTIALS environment variable (path to JSON file)
# Option 2: Upload google-cloud-service-account.json to Railway and set GOOGLE_APPLICATION_CREDENTIALS=/path/to/file
# Option 3: Use default credentials (if running on GCP)
# Option 4: Set individual credential fields as environment variables (similar to Firebase):
#   - GOOGLE_CLOUD_PRIVATE_KEY_ID
#   - GOOGLE_CLOUD_PRIVATE_KEY
#   - GOOGLE_CLOUD_CLIENT_EMAIL
#   - GOOGLE_CLOUD_CLIENT_ID
#   - GOOGLE_CLOUD_CLIENT_X509_CERT_URL

# Enable/Disable specific AI services (optional, defaults to false)
google.cloud.translate.enabled=${GOOGLE_CLOUD_TRANSLATE_ENABLED:false}
google.cloud.natural-language.enabled=${GOOGLE_CLOUD_NATURAL_LANGUAGE_ENABLED:false}
google.cloud.speech.enabled=${GOOGLE_CLOUD_SPEECH_ENABLED:false}
google.cloud.text-to-speech.enabled=${GOOGLE_CLOUD_TEXT_TO_SPEECH_ENABLED:false}

# AI Service Limits and Configuration
ai.translation.max-length=${AI_TRANSLATION_MAX_LENGTH:5000}
ai.sentiment.max-length=${AI_SENTIMENT_MAX_LENGTH:10000}
ai.text-to-speech.max-length=${AI_TEXT_TO_SPEECH_MAX_LENGTH:5000}
ai.speech-to-text.sample-rate=${AI_SPEECH_TO_TEXT_SAMPLE_RATE:16000}

# Kaiwa Practice Scoring Configuration
kaiwa.scoring.accuracy-weight=${KAIWA_SCORING_ACCURACY_WEIGHT:0.6}
kaiwa.scoring.pronunciation-weight=${KAIWA_SCORING_PRONUNCIATION_WEIGHT:0.4}

# JLPT Level Score Adjustments (multipliers for stricter scoring at higher levels)
kaiwa.scoring.adjustment.n1=${KAIWA_SCORING_ADJUSTMENT_N1:0.95}
kaiwa.scoring.adjustment.n2=${KAIWA_SCORING_ADJUSTMENT_N2:0.97}
kaiwa.scoring.adjustment.n3=${KAIWA_SCORING_ADJUSTMENT_N3:0.98}
kaiwa.scoring.adjustment.n4=${KAIWA_SCORING_ADJUSTMENT_N4:0.99}
kaiwa.scoring.adjustment.n5=${KAIWA_SCORING_ADJUSTMENT_N5:1.0}

# JLPT Level Accuracy Thresholds (minimum score to pass)
kaiwa.threshold.accuracy.n1=${KAIWA_THRESHOLD_ACCURACY_N1:0.9}
kaiwa.threshold.accuracy.n2=${KAIWA_THRESHOLD_ACCURACY_N2:0.85}
kaiwa.threshold.accuracy.n3=${KAIWA_THRESHOLD_ACCURACY_N3:0.8}
kaiwa.threshold.accuracy.n4=${KAIWA_THRESHOLD_ACCURACY_N4:0.75}
kaiwa.threshold.accuracy.n5=${KAIWA_THRESHOLD_ACCURACY_N5:0.7}
kaiwa.threshold.accuracy.default=${KAIWA_THRESHOLD_ACCURACY_DEFAULT:0.8}

# JLPT Level Practice Thresholds (below this score needs more practice)
kaiwa.threshold.practice.n1=${KAIWA_THRESHOLD_PRACTICE_N1:0.85}
kaiwa.threshold.practice.n2=${KAIWA_THRESHOLD_PRACTICE_N2:0.8}
kaiwa.threshold.practice.n3=${KAIWA_THRESHOLD_PRACTICE_N3:0.75}
kaiwa.threshold.practice.n4=${KAIWA_THRESHOLD_PRACTICE_N4:0.7}
kaiwa.threshold.practice.n5=${KAIWA_THRESHOLD_PRACTICE_N5:0.65}
kaiwa.threshold.practice.default=${KAIWA_THRESHOLD_PRACTICE_DEFAULT:0.7}

# JLPT Level Tolerance (error tolerance for accuracy calculation)
kaiwa.tolerance.n1=${KAIWA_TOLERANCE_N1:0.05}
kaiwa.tolerance.n2=${KAIWA_TOLERANCE_N2:0.08}
kaiwa.tolerance.n3=${KAIWA_TOLERANCE_N3:0.10}
kaiwa.tolerance.n4=${KAIWA_TOLERANCE_N4:0.12}
kaiwa.tolerance.n5=${KAIWA_TOLERANCE_N5:0.15}
kaiwa.tolerance.default=${KAIWA_TOLERANCE_DEFAULT:0.15}

# JLPT Level Partial Match Boost (score boost for partial matches)
kaiwa.partial-match-boost.n1=${KAIWA_PARTIAL_MATCH_BOOST_N1:0.6}
kaiwa.partial-match-boost.n2=${KAIWA_PARTIAL_MATCH_BOOST_N2:0.65}
kaiwa.partial-match-boost.n3=${KAIWA_PARTIAL_MATCH_BOOST_N3:0.7}
kaiwa.partial-match-boost.n4=${KAIWA_PARTIAL_MATCH_BOOST_N4:0.75}
kaiwa.partial-match-boost.n5=${KAIWA_PARTIAL_MATCH_BOOST_N5:0.8}
kaiwa.partial-match-boost.default=${KAIWA_PARTIAL_MATCH_BOOST_DEFAULT:0.7}

# JLPT Level Speaking Rates (for Text-to-Speech)
kaiwa.speaking-rate.n1=${KAIWA_SPEAKING_RATE_N1:1.5}
kaiwa.speaking-rate.n2=${KAIWA_SPEAKING_RATE_N2:1.25}
kaiwa.speaking-rate.n3=${KAIWA_SPEAKING_RATE_N3:1.0}
kaiwa.speaking-rate.n4=${KAIWA_SPEAKING_RATE_N4:0.85}
kaiwa.speaking-rate.n5=${KAIWA_SPEAKING_RATE_N5:0.75}
kaiwa.speaking-rate.default=${KAIWA_SPEAKING_RATE_DEFAULT:1.0}

# Feedback Score Thresholds
ai.feedback.threshold.excellent=${AI_FEEDBACK_THRESHOLD_EXCELLENT:0.9}
ai.feedback.threshold.good=${AI_FEEDBACK_THRESHOLD_GOOD:0.7}
ai.feedback.threshold.average=${AI_FEEDBACK_THRESHOLD_AVERAGE:0.5}
ai.feedback.threshold.sentiment.positive=${AI_FEEDBACK_THRESHOLD_SENTIMENT_POSITIVE:0.25}
ai.feedback.threshold.sentiment.negative=${AI_FEEDBACK_THRESHOLD_SENTIMENT_NEGATIVE:-0.25}

# Text-to-Speech Speed Configuration
ai.text-to-speech.speed.slow=${AI_TEXT_TO_SPEECH_SPEED_SLOW:0.75}
ai.text-to-speech.speed.normal=${AI_TEXT_TO_SPEECH_SPEED_NORMAL:1.0}
ai.text-to-speech.speed.fast=${AI_TEXT_TO_SPEECH_SPEED_FAST:1.5}

# Sentence Analysis Configuration
ai.sentence-analysis.max-length=${AI_SENTENCE_ANALYSIS_MAX_LENGTH:100}
google.cloud.gemini.api-key=${GOOGLE_CLOUD_GEMINI_API_KEY:}
google.cloud.gemini.model=${GOOGLE_CLOUD_GEMINI_MODEL:gemini-pro}

# Logging Configuration
# Railway requires logs to be output to stdout/stderr
logging.level.com.hokori.web=INFO
logging.level.com.hokori.web.controller=INFO
logging.level.org.springframework.security=WARN
logging.level.org.hibernate=WARN
logging.level.org.springframework.web=INFO
logging.level.org.springframework.web.servlet.DispatcherServlet=INFO

# Logging pattern for console output (Railway needs stdout)
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n
logging.pattern.level=%5p

# Enable HTTP request logging
logging.level.org.springframework.web.filter.CommonsRequestLoggingFilter=DEBUG
spring.mvc.log-request-details=true

# Disable Thymeleaf template location check
spring.thymeleaf.check-template-location=false

# PayOS Payment Gateway Configuration (from environment variables)
# Note: If variables are not set, payment features will be disabled gracefully
payos.enabled=${PAYOS_ENABLED:false}
payos.client-id=${PAYOS_CLIENT_ID:}
payos.api-key=${PAYOS_API_KEY:}
payos.checksum-key=${PAYOS_CHECKSUM_KEY:}
payos.api-url=${PAYOS_API_URL:https://api.payos.vn/v2}
payos.webhook-url=${PAYOS_WEBHOOK_URL:}
payos.return-url=${PAYOS_RETURN_URL:}
payos.cancel-url=${PAYOS_CANCEL_URL:}

