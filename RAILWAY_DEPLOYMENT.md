# 🚀 HOKORI WEB - RAILWAY DEPLOYMENT GUIDE

## 📋 **Environment Variables cần thiết trên Railway:**

### 🔑 **Database Configuration (AUTO-GENERATED by Railway)**
```bash
# Railway tự động tạo khi add PostgreSQL service:
DATABASE_URL=postgresql://username:password@host:port/database
# Không cần set DATABASE_USERNAME và DATABASE_PASSWORD riêng
```

### 🔥 **Firebase Configuration (OPTIONAL - cho Google Login)**
```bash
FIREBASE_ENABLED=true
FIREBASE_PROJECT_ID=your-firebase-project-id
FIREBASE_CREDENTIALS_PATH=classpath:firebase-service-account.json
```

### 🔐 **JWT Configuration (REQUIRED)**
```bash
JWT_SECRET=your-super-secret-jwt-key-minimum-32-characters
JWT_EXPIRATION=86400000
```

### ⚙️ **Spring Configuration**
```bash
SPRING_PROFILES_ACTIVE=prod
JPA_DDL_AUTO=update
```

### 🗄️ **Database Pool Configuration (OPTIONAL)**
```bash
DB_POOL_SIZE=10
DB_POOL_MIN=2
DB_CONNECTION_TIMEOUT=20000
DB_IDLE_TIMEOUT=300000
```

---

## 🛠️ **Bước deploy lên Railway:**

### 1. **Tạo project trên Railway**
```bash
# Kết nối GitHub repo với Railway
# Chọn repository: hokori-web
```

### 2. **Thêm PostgreSQL Database**
```bash
# Trong Railway dashboard:
# Add Service → Database → PostgreSQL
# Railway sẽ tự động tạo DATABASE_URL environment variable
```

### 3. **Cấu hình Environment Variables**
```bash
# Trong Railway project settings → Variables
# Thêm tất cả các biến environment ở trên
```

### 4. **Deploy**
```bash
# Railway sẽ tự động build và deploy
# Kiểm tra logs nếu có lỗi
```

---

## 🔧 **API Endpoints có sẵn:**

### 🔐 **Authentication**
```bash
POST /api/auth/register          # Đăng ký tài khoản mới
POST /api/auth/login             # Đăng nhập username/password
POST /api/auth/login/firebase    # Đăng nhập Google Firebase
POST /api/auth/refresh           # Refresh JWT token
POST /api/auth/validate          # Validate JWT token
```

### 📊 **Health Check**
```bash
GET /actuator/health             # Health check endpoint
GET /api/health                  # Custom health endpoint
```

### 📚 **API Documentation**
```bash
GET /swagger-ui.html             # Swagger UI
GET /v3/api-docs                 # OpenAPI JSON
```

---

## 🧪 **Test API với cURL:**

### 1. **Đăng ký tài khoản mới:**
```bash
curl -X POST https://your-app.railway.app/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "email": "test@example.com",
    "password": "password123",
    "displayName": "Test User",
    "country": "Vietnam",
    "nativeLanguage": "Vietnamese",
    "currentJlptLevel": "N5"
  }'
```

### 2. **Đăng nhập:**
```bash
curl -X POST https://your-app.railway.app/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "password123"
  }'
```

### 3. **Sử dụng JWT token:**
```bash
curl -X GET https://your-app.railway.app/api/users/profile \
  -H "Authorization: Bearer YOUR_JWT_TOKEN_HERE"
```

---

## 🎯 **Các tính năng đã hoàn thành:**

✅ **Authentication System**
- ✅ Username/Password login
- ✅ Google Firebase login
- ✅ JWT token generation & validation
- ✅ User registration
- ✅ Password encryption (BCrypt)

✅ **Database Setup**
- ✅ SQL Server integration
- ✅ User & Role entities
- ✅ Automatic role creation
- ✅ Connection pooling

✅ **Security Configuration**
- ✅ JWT Authentication Filter
- ✅ CORS configuration
- ✅ Public endpoints protection
- ✅ Role-based access control

✅ **Railway Deployment**
- ✅ Environment-based configuration
- ✅ Production-ready settings
- ✅ Health check endpoints
- ✅ Swagger documentation

---

## 🔍 **Troubleshooting:**

### Database Connection Issues:
```bash
# Kiểm tra DATABASE_URL format
# Đảm bảo SQL Server cho phép external connections
# Kiểm tra firewall settings
```

### JWT Token Issues:
```bash
# Đảm bảo JWT_SECRET đủ dài (>= 32 characters)
# Kiểm tra token expiration time
```

### Firebase Issues:
```bash
# Upload firebase-service-account.json vào src/main/resources/
# Đặt FIREBASE_ENABLED=false nếu không dùng Google login
```

---

## 🚀 **Ready to Deploy!**

Project đã sẵn sàng deploy lên Railway với đầy đủ tính năng authentication cho web học tiếng Nhật!
